{% extends "base.html" %}
{% block title %} assess {% endblock %}

{% block header %} 

<script type="text/javascript" src="/site_media/openlayers/OpenLayers.js"></script>



<link type="text/css" href="/site_media/theme/jquery-ui-1.7.1.custom.css" rel="Stylesheet" />  
<script type="text/javascript" src="/site_media/jquery-1.3.2.min.js"></script>

<script type="text/javascript" src="/site_media/jquery-ui-1.7.1.custom.min.js"></script>
<script type="text/javascript" src="/site_media/corner/jquery.corners.js"></script>



<script defer="defer" type="text/javascript">
    var map, layer, select;
	 $(document).ready(function() {		
		 loadMap(); 
		 $('ul#assess li').hover( 
		       function (){ 
			   $(this).effect("highlight", {}, 3000);
/*
              popup = new OpenLayers.Popup("chicken",
							new OpenLayers.LonLat(5,40),
							new OpenLayers.Size(200,200),
							"example popup",
							true);
			   map.addPopup(popup);
*/
                  }); 
	     }); 


    var options = {
            projection: new OpenLayers.Projection("EPSG:900913"),
	    displayProjection: new OpenLayers.Projection("EPSG:4326"),
	    units: "m",
	    numZoomLevels:19,
            maxResolution: 156543.03390625,
	    maxExtent: new OpenLayers.Bounds(-20037508.34, -20037508.34,
					     20037508.34, 20037508.34)
	   };

        function loadMap(){
	map = new OpenLayers.Map('map',options);

	var osm = new OpenLayers.Layer.WMS(
                 "OpenStreetMap",
                 "http://maps.opengeo.org/geowebcache/service/wms",   
       {
            layers: "openstreetmap", 
            format: "image/png",
            bgcolor: '#A1BDC4'
            }, 
            {wrapDateLine: true} 
        );
    
	var style = new OpenLayers.Style({
                    pointRadius: "8",
		    label: "${id}",
	            fontColor: "#eee",
		    fillColor: "#DFABAB",
                    strokeColor: "#DFABAB",
                    strokeWidth: 2,
                    strokeOpacity: 0.8
		    
                }, {
                    context: {
                        radius: function(feature) {
                            return Math.min(feature.attributes.count, 7) + 5;
		    }, 
			id: function(feature) { 
			return feature.attributes.id ; 
		    } 
                    }
                });


	var racks = new OpenLayers.Layer.Vector("Racks", {
		    projection: map.displayProjection,
                    strategies: [
                        new OpenLayers.Strategy.Fixed()
                    ],		  
                    protocol: new OpenLayers.Protocol.HTTP({
                        url: "./rack/requested.kml",
                        params: {		     
				
                        },
                        format: new OpenLayers.Format.KML()
                    }),
                    styleMap: new OpenLayers.StyleMap({
                        "default": style,
                        "select": {
                            fillColor: "#8aeeef",
                            strokeColor: "#32a8a9"
                        }
                    })

                });
    
        map.addLayers([osm,racks]);


    
        var bounds = new OpenLayers.Bounds(-73.978431701660199, 40.6752319335938, -73.946891784667997, 40.723712921142599) ; 
	bounds.transform(map.displayProjection, map.projection); 
        map.zoomToExtent(bounds); 
        }


</script>
{% endblock %}



{% block menu %} 
<ul id="menu">
  <li class="suggest">
    <a href="/">(1) SUGGEST</a>
    <p> Suggest a bike rack location </p>
  </li>
  <li class="assess">
    <a href="/assess/">(2) ASSESS</a>
    <p> Assess current requested locations </p>
  </li>
  <li class="about">
  <a href="/about/">About this projecet</a>    
  <p> Find out more information</p>
  </li>
</ul>

{% endblock %}

{% block content %}
<div class="assess">
  <div id="map-con">
    <div> 
      <h2>Go out and assess !</h2> 
    </div>
    <div id="map"> 
    </div>
  </div>


<div id="activity-con">
  <h3> Vet suggestions for submission! </h3>

   
{% regroup rack_query by communityboard as rack_list %} 
    <ul>
   {% for rack_query in rack_list %} 
       <li>  <h3><a href="/assess/communityboard/{{rack_query.grouper.name}}">{{rack_query.grouper}}</a></h3></li>
   {% endfor %} 
    </ul>
</div>
</div>
{% endblock %}
