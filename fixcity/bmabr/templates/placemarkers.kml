{% extends "base.kml" %}
{% block placemarks %}

{% for rack in page.object_list %}
  <Placemark>

    <atom:id>{{rack.id}}</atom:id>
    <name>{{rack.title}}</name>
    <address>{{rack.address}}</address>

    <description>{{rack.description|default:""}}</description>	
    <Snippet>{{rack.description|default:""|truncatewords:12}}</Snippet>	

    {% if rack.photo %}
     <!-- can't find anything suitable in the kml spec... 
          let's make some tag soup -->
     <topp:thumbnail>{{rack.photo.thumbnail}}</topp:thumbnail>
    {% endif %}


    {% autoescape off %}
    {{rack.location.kml}}    
    {% endautoescape %}	

    {% if forloop.first %}
      <!-- let's sneak pagination in here. 
           I tried to use http://tools.ietf.org/html/rfc5005#section-3
           but the KML parser in OpenLayers doesn't handle it. 
      -->
      <topp:page_number>{{page.number}}</topp:page_number>

      {% if page.has_previous %}
        <topp:page_previous>{{page.previous_page_number}}</topp:page_previous>
      {% endif %}

      {% if page.has_next %}
        <topp:page_next>{{page.next_page_number}}</topp:page_next>
      {% endif %}

      <topp:num_pages>{{page.paginator.num_pages}}</topp:num_pages>

    {% endif %}

  </Placemark>
{% endfor %}{% endblock %}

